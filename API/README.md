# Hailo AI People Counter API

A comprehensive REST API for accessing people counter data generated by the Hailo AI detection system. This API provides real-time access to people detection statistics with multiple data views and aggregation options.

## üìã Table of Contents

- [Overview](#overview)
- [Quick Start](#quick-start)
- [API Endpoints](#api-endpoints)
- [Data Format](#data-format)
- [Examples](#examples)
- [Error Handling](#error-handling)
- [Configuration](#configuration)
- [Troubleshooting](#troubleshooting)

## üéØ Overview

The Hailo AI People Counter API serves data from CSV files generated by the people detection system. It provides:

- **Real-time data access** from CSV files
- **Multiple data views** (raw, summary, hourly, daily)
- **Pagination support** for large datasets
- **Comprehensive statistics** and aggregations
- **RESTful design** with JSON responses
- **Error handling** with proper HTTP status codes

## üöÄ Quick Start

### Prerequisites

- Python 3.7+
- Flask 2.3.3+
- pandas 2.0.3+

### Installation

1. **Install dependencies:**
   ```bash
   pip install -r api_requirements.txt
   ```

2. **Start the API server:**
   ```bash
   python api.py
   ```

3. **Access the API:**
   ```
   http://localhost:123
   ```

### Quick Test

```bash
# Test the API is running
curl http://localhost:123/

# Get latest data
curl http://localhost:123/data/latest
```

## üîó API Endpoints

### 1. API Information
**GET /** - Get API metadata and available endpoints

**Response:**
```json
{
  "api_name": "Hailo AI People Counter API",
  "version": "1.0.0",
  "description": "RESTful API for accessing people counter CSV data",
  "endpoints": {
    "GET /": "API information",
    "GET /data": "All CSV data",
    "GET /data/latest": "Latest data entry",
    "GET /data/summary": "Summary statistics",
    "GET /data/hourly": "Hourly aggregated data",
    "GET /data/daily": "Daily aggregated data",
    "GET /data/current": "Current time period data"
  },
  "csv_file": "/path/to/people_count_log.csv",
  "timestamp": "2025-01-27T10:30:00"
}
```

### 2. All Data
**GET /data** - Get all CSV data with optional pagination

**Query Parameters:**
- `limit` (int): Maximum number of records to return
- `offset` (int): Number of records to skip

**Examples:**
```bash
# Get all data
curl http://localhost:123/data

# Get first 10 records
curl http://localhost:123/data?limit=10

# Get records 20-29 (skip 20, limit 10)
curl http://localhost:123/data?limit=10&offset=20
```

**Response:**
```json
{
  "data": [
    {
      "Timestamp": "2025-08-04 02:03:16",
      "Minute": 29238183,
      "Hour": 487303,
      "Day": 20304,
      "People_This_Minute": 1,
      "People_This_Hour": 1,
      "People_This_Day": 1,
      "Total_Unique_People": 1
    }
  ],
  "total_records": 1,
  "timestamp": "2025-01-27T10:30:00"
}
```

### 3. Latest Data
**GET /data/latest** - Get the most recent data entry

**Example:**
```bash
curl http://localhost:123/data/latest
```

**Response:**
```json
{
  "latest_data": {
    "Timestamp": "2025-08-04 02:03:16",
    "Minute": 29238183,
    "Hour": 487303,
    "Day": 20304,
    "People_This_Minute": 1,
    "People_This_Hour": 1,
    "People_This_Day": 1,
    "Total_Unique_People": 1
  },
  "timestamp": "2025-01-27T10:30:00"
}
```

### 4. Summary Statistics
**GET /data/summary** - Get comprehensive summary statistics

**Example:**
```bash
curl http://localhost:123/data/summary
```

**Response:**
```json
{
  "summary": {
    "total_records": 150,
    "date_range": {
      "start": "2025-01-20T08:00:00",
      "end": "2025-01-27T10:30:00"
    },
    "people_statistics": {
      "max_people_this_minute": 5,
      "max_people_this_hour": 25,
      "max_people_this_day": 150,
      "max_total_unique_people": 200,
      "avg_people_this_minute": 2.3,
      "avg_people_this_hour": 12.5,
      "avg_people_this_day": 75.2
    },
    "current_totals": {
      "people_this_minute": 3,
      "people_this_hour": 18,
      "people_this_day": 95,
      "total_unique_people": 200
    }
  },
  "timestamp": "2025-01-27T10:30:00"
}
```

### 5. Hourly Data
**GET /data/hourly** - Get hourly aggregated data

**Query Parameters:**
- `hours` (int): Number of hours to look back (default: 24)

**Examples:**
```bash
# Get last 24 hours (default)
curl http://localhost:123/data/hourly

# Get last 48 hours
curl http://localhost:123/data/hourly?hours=48

# Get last 6 hours
curl http://localhost:123/data/hourly?hours=6
```

**Response:**
```json
{
  "hourly_data": [
    {
      "hour": 487303,
      "timestamp": "2025-01-27T09:00:00",
      "people_this_hour": 15,
      "total_unique_people": 180
    },
    {
      "hour": 487304,
      "timestamp": "2025-01-27T10:00:00",
      "people_this_hour": 18,
      "total_unique_people": 200
    }
  ],
  "hours_analyzed": 24,
  "timestamp": "2025-01-27T10:30:00"
}
```

### 6. Daily Data
**GET /data/daily** - Get daily aggregated data

**Query Parameters:**
- `days` (int): Number of days to look back (default: 7)

**Examples:**
```bash
# Get last 7 days (default)
curl http://localhost:123/data/daily

# Get last 30 days
curl http://localhost:123/data/daily?days=30

# Get last 3 days
curl http://localhost:123/data/daily?days=3
```

**Response:**
```json
{
  "daily_data": [
    {
      "day": 20303,
      "timestamp": "2025-01-26T23:59:59",
      "people_this_day": 120,
      "total_unique_people": 180
    },
    {
      "day": 20304,
      "timestamp": "2025-01-27T10:30:00",
      "people_this_day": 95,
      "total_unique_people": 200
    }
  ],
  "days_analyzed": 7,
  "timestamp": "2025-01-27T10:30:00"
}
```

### 7. Current Data
**GET /data/current** - Get current time period data

**Example:**
```bash
curl http://localhost:123/data/current
```

**Response:**
```json
{
  "current_data": {
    "current_time": "2025-01-27T10:30:00",
    "current_periods": {
      "minute": 29238183,
      "hour": 487303,
      "day": 20304
    },
    "latest_data": {
      "timestamp": "2025-08-04 02:03:16",
      "people_this_minute": 3,
      "people_this_hour": 18,
      "people_this_day": 95,
      "total_unique_people": 200
    }
  },
  "timestamp": "2025-01-27T10:30:00"
}
```

## üìä Data Format

The API serves data with the following structure:

| Field | Type | Description |
|-------|------|-------------|
| `Timestamp` | string | ISO format timestamp |
| `Minute` | int | Minute since epoch |
| `Hour` | int | Hour since epoch |
| `Day` | int | Day since epoch |
| `People_This_Minute` | int | People detected in current minute |
| `People_This_Hour` | int | People detected in current hour |
| `People_This_Day` | int | People detected in current day |
| `Total_Unique_People` | int | Total unique people detected |

## üí° Examples

### Python Examples

```python
import requests
import json

# Base URL
BASE_URL = "http://localhost:123"

# Get API information
response = requests.get(f"{BASE_URL}/")
print(json.dumps(response.json(), indent=2))

# Get latest data
response = requests.get(f"{BASE_URL}/data/latest")
latest = response.json()
print(f"Latest people count: {latest['latest_data']['Total_Unique_People']}")

# Get summary statistics
response = requests.get(f"{BASE_URL}/data/summary")
summary = response.json()
print(f"Total records: {summary['summary']['total_records']}")

# Get hourly data for last 48 hours
response = requests.get(f"{BASE_URL}/data/hourly?hours=48")
hourly = response.json()
for hour_data in hourly['hourly_data']:
    print(f"Hour {hour_data['hour']}: {hour_data['people_this_hour']} people")

# Get paginated data
response = requests.get(f"{BASE_URL}/data?limit=5&offset=10")
data = response.json()
print(f"Retrieved {len(data['data'])} records")
```

### JavaScript Examples

```javascript
// Get API information
fetch('http://localhost:123/')
  .then(response => response.json())
  .then(data => console.log('API Info:', data));

// Get latest data
fetch('http://localhost:123/data/latest')
  .then(response => response.json())
  .then(data => {
    console.log('Latest people count:', data.latest_data.Total_Unique_People);
  });

// Get summary statistics
fetch('http://localhost:123/data/summary')
  .then(response => response.json())
  .then(data => {
    const stats = data.summary.people_statistics;
    console.log('Max people this hour:', stats.max_people_this_hour);
    console.log('Average people this day:', stats.avg_people_this_day);
  });

// Get hourly data
fetch('http://localhost:123/data/hourly?hours=24')
  .then(response => response.json())
  .then(data => {
    data.hourly_data.forEach(hour => {
      console.log(`Hour ${hour.hour}: ${hour.people_this_hour} people`);
    });
  });
```

### cURL Examples

```bash
# Get all data with pagination
curl "http://localhost:123/data?limit=10&offset=0" | jq '.'

# Get summary and extract specific values
curl "http://localhost:123/data/summary" | jq '.summary.people_statistics.max_people_this_hour'

# Get hourly data for last 12 hours
curl "http://localhost:123/data/hourly?hours=12" | jq '.hourly_data[] | {hour: .hour, people: .people_this_hour}'

# Get current data and format nicely
curl "http://localhost:123/data/current" | jq '.current_data.latest_data | {timestamp, people_this_minute, people_this_hour, total_unique_people}'
```

## ‚ö†Ô∏è Error Handling

The API returns appropriate HTTP status codes:

| Status Code | Description | Example Response |
|-------------|-------------|------------------|
| 200 | Success | `{"data": [...], "timestamp": "..."}` |
| 404 | No data available or endpoint not found | `{"error": "No data available"}` |
| 500 | Internal server error | `{"error": "Internal server error"}` |

### Error Response Format

```json
{
  "error": "No data available for the last 48 hours"
}
```

## ‚öôÔ∏è Configuration

### Environment Variables

The API can be configured by modifying `api.py`:

```python
# Change port (default: 123)
PORT = 8080

# Change CSV file path
CSV_FILE = Path(__file__).parent / "custom_data.csv"

# Change host binding
app.run(host='127.0.0.1', port=PORT, debug=False)
```

### Development Mode

For development with auto-reload:

```python
app.run(host='0.0.0.0', port=123, debug=True)
```

## üîß Troubleshooting

### Common Issues

1. **Port already in use**
   ```bash
   # Check what's using port 123
   netstat -tulpn | grep :123
   
   # Kill the process or change port in api.py
   ```

2. **CSV file not found**
   ```bash
   # Check if CSV file exists
   ls -la people_count_log.csv
   
   # Ensure correct path in api.py
   ```

3. **Permission denied**
   ```bash
   # Check file permissions
   chmod 644 people_count_log.csv
   
   # Run with appropriate permissions
   sudo python api.py
   ```

4. **Dependencies missing**
   ```bash
   # Install dependencies
   pip install -r api_requirements.txt
   
   # Check Python version
   python --version
   ```

### Debug Mode

Enable debug mode for detailed error messages:

```python
app.run(host='0.0.0.0', port=123, debug=True)
```

### Logging

Add logging to track API usage:

```python
import logging

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

@app.before_request
def log_request():
    logger.info(f"{request.method} {request.path}")
```

## üìà Performance Tips

1. **Use pagination** for large datasets
2. **Cache frequently accessed data** if needed
3. **Use appropriate time ranges** for hourly/daily queries
4. **Monitor CSV file size** and implement rotation if needed

## üîí Security Considerations

1. **Restrict host binding** in production:
   ```python
   app.run(host='127.0.0.1', port=123)  # Local only
   ```

2. **Add authentication** if needed:
   ```python
   from functools import wraps
   from flask import request, jsonify
   
   def require_api_key(f):
       @wraps(f)
       def decorated_function(*args, **kwargs):
           api_key = request.headers.get('X-API-Key')
           if api_key != 'your-secret-key':
               return jsonify({'error': 'Invalid API key'}), 401
           return f(*args, **kwargs)
       return decorated_function
   ```

3. **Rate limiting** for production use
4. **HTTPS** for sensitive data

## üìù License

This API is part of the Hailo AI People Counter project.

---

**Need help?** Check the troubleshooting section or create an issue in the project repository. 